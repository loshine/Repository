# build.gradle

## Gradle 脚本

在 Android Studio 中创建了一个项目后，会为我们默认生成三个 gradle 文件，如下所示：

```bash
MyApp
  ├── build.gradle
  ├── settings.gradle
  └── app
       └── build.gradle
```

### setting.gradle

`setting.gradle`文件将会在初始化时期执行，定义哪个模块将会参与构建

初始情况下它是这样的

```groovy
include ':app'
```

如有多个模块

```groovy
include ':app', ':library1', 'library2', ...
```

### 根目录 build.gradle

该文件是定义在这个工程下的所有模块的公共属性

```groovy
// build 全局设置
buildscript {
    // 使用 jcenter 仓库
    repositories {
        jcenter()
    }

    // 配置依赖
    dependencies {
        classpath 'com.android.tools.build:gradle:2.0.0-beta6'
    }
}

// 所有子模块默认设置，可以被子模块覆盖
allprojects {
    repositories {
        jcenter()
    }
}

// 定义一个 task
task clean(type: Delete) {
    delete rootProject.buildDir
}
```

### 模块内的 build.gradle

模块内的 gradle 文件只对该模块起作用，而且其可以重写任何的参数来自于根目录下的 gradle 文件。

```groovy
// 启用 Android 插件
apply plugin: 'com.android.application'

// 配置 Android 插件属性
android {
    compileSdkVersion 23 // 编译 SDK 版本
    buildToolsVersion "23.0.2" // 编译工具版本

    // 默认设置
    defaultConfig {
        applicationId "io.github.loshine.demo" // 唯一包名
        minSdkVersion 15 // 最低兼容版本
        targetSdkVersion 23 // 目标版本
        versionCode 1 // 版本号
        versionName "1.0" // 版本名称
    }

    // 构建类型，根据项目需要定义

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}
// 第三方依赖
dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    testCompile 'junit:junit:4.12'
    compile 'com.android.support:appcompat-v7:23.2.0'
}
```

### BuildConfig 和 resources

定义如下的常量属性，可以在代码中使用：`BuildConfig.API_URL`和`BuildConfig.LOG_HTTP`在对应的构建版本访问它们

```groovy
android {
    buildTypes {
        debug {
            buildConfigField "String", "API_URL", "\"http://test.example.com/api\""
            buildConfigField "boolean", "LOG_HTTP_CALLS", "true"
        }
        release {
            buildConfigField "String", "API_URL", "\"http://example.com/api\""
            buildConfigField "boolean", "LOG_HTTP_CALLS", "false"
        }
    }
}
```

现在我们也可以直接定义 **string**

```groovy
android {
    buildTypes {
        debug {
            resValue "string", "app_name", "Example DEBUG"
        }

        release {
            resValue "string", "app_name", "Example"
        }
    }
}
```

我们可以使用`R.string.app_name`访问

### 全局设置

如果有多个模块共用设置，我们可以在根目录下的`build.gradle`中设置全局属性

```groovy
ext {
    compile_sdk_version = 23
    build_tools_version = "23.0.2"
}
```

然后就可以在子模块中如下使用

```groovy
android {
    compileSdkVersion compile_sdk_version
    buildToolsVersion build_tools_version
}
```

### Properties 文件

`gradle.properties`文件中也可以设置全局属性

```groovy
compile_sdk_version = 23
build_tools_version = "23.0.2"
```

该文件中的属性会被自动引入所有 **gradle** 脚本