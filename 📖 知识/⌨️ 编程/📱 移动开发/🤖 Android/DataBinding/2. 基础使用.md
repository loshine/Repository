# 基础使用

## 添加 layout tag

在布局的最外层套上`<layout>`标签，修改后就可以看到生成了该布局对应的 *Binding 类。

也可以自定义生成的  Binding 实例的名字

```xml
<layout>
    <data class="testBinding" />
</layout>
```

## 生成 Binding

## Activity

```java
ActivityMainBinding binding = DataBindingUtil.setContentView(MainActivity.this, R.layout.activity_main);
```

### Fragment

```java
FragmentTestBinding binding = DataBindingUtil.inflate(inflater, R.layout.fragment_test, parent, false);
```

## 去除 findViewById

使用了Data Binding 后，我们再也不需要`findViewById`，因为一切有 id 的 view，都已经在 Binding 类中被初始化完成了，只需要直接通过 binding 实例访问即可。

## 变量绑定

使用`data`标签，我们就可以在 xml 中申明变量，在其中使用该变量的 field，并通过 binding 实例 set 进来。

```xml
<data>
    <variable
        name="employee"
        type="com.github.markzhai.databindingsample.Employee"/>
</data>
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:gravity="center_horizontal"
    android:orientation="vertical"
    tools:context=".DemoActivity">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@{employee.lastName}"
        android:layout_marginLeft="5dp"/>

</LinearLayout>
```

然后使用如下代码将 ViewModel 设置进来

```java
binding.setEmployee(employee);
// 或者直接通过setVariable
binding.setVariable(BR.employee, employee);
```

## 事件绑定

严格意义上来说，事件绑定也是一种变量绑定。我们可以在 xml 中直接绑定

* android:onClick
* android:onLongClick
* android:onTextChanged
* …

### 方法引用

通常会定义一个名为 Handler 或者 Presenter 的类，然后 set 进来，方法签名需和对应 listener 方法一致。

```xml
<layout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    xmlns:bind="http://schemas.android.com/apk/res-auto">

    <data>

        <import type="android.view.View"/>

        <variable
            name="employee"
            type="com.github.markzhai.databindingsample.Employee"/>

        <variable
            name="presenter"
            type="com.github.markzhai.databindingsample.DemoActivity.Presenter"/>
    </data>

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:gravity="center_horizontal"
        android:orientation="vertical"
        tools:context=".DemoActivity">

        <EditText
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="输入 First Name"
            android:onTextChanged="@{presenter::onTextChanged}"/>

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:onClick="@{presenter.onClick}"
            android:text="@{employee.firstName}"/>

    </LinearLayout>

</layout>
```

在Java代码中:

```java
@Override
protected void onCreate(Bundle savedInstanceState) {
    ...
    binding.setPresenter(new Presenter());
    ...
}

public class Presenter {
    public void onTextChanged(CharSequence s, int start, int before, int count) {
        employee.setFirstName(s.toString());
        employee.setFired(!employee.isFired.get());
    }

    public void onClick(View view) {
        Toast.makeText(DemoActivity.this, "点到了", Toast.LENGTH_SHORT).show();
    }
}
```

### lambda

```xml
<TextView
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_margin="5dp"
    android:visibility="@{employee.isFired ? View.GONE : View.VISIBLE}"
    android:onClick="@{() -> presenter.onClickListenerBinding(employee)}"/>
```

```java
public class Presenter {
    public void onClickListenerBinding(Employee employee) {
        Toast.makeText(DemoActivity.this, employee.getLastName(),
                Toast.LENGTH_SHORT).show();
    }
}
```