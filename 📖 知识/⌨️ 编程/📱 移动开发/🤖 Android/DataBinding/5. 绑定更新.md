# 绑定更新

## Observable

一个纯净的 Java ViewModel 类被更新后，并不会让 UI 去更新。而数据绑定后，我们当然会希望数据变更后 UI 会即时刷新，Observable 就是为此而生的概念。

## BaseObservable

想要更新属性之后更新对应 UI 的 ViewModel 可以继承 BaseObservable 类，BaseObservable 提供了两个方法：

* `notifyChange`：通知所有属性刷新
* `notifyPropertyChanged`：通知对应域刷新

一个例子：

```java
public class User extends BaseObservable {
    private String firstName;
    private String lastName;

    @Bindable
    public String getFirstName() {
        return this.firstName;
    }

    @Bindable
    public String getLastName() {
        return this.lastName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
        notifyPropertyChanged(BR.firstName);
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
        notifyPropertyChanged(BR.lastName);
    }
}
```

## ObservableFields

如果所有的需要绑定的类都要继承 Observable 并对其方法实现，那会非常麻烦。

Data Binding 还提供了如下一系列 Observable

* ObservableBoolean
* ObservableByte
* ObservableChar
* ObservableShort
* ObservableInt
* ObservableLong
* ObservableFloat
* ObservableDouble
* ObservableParcelable
* ObservableField：泛型属性

一个例子：

```java
private static class User {
   public final ObservableField<String> firstName =
       new ObservableField<>();
   public final ObservableField<String> lastName =
       new ObservableField<>();
   public final ObservableInt age = new ObservableInt();
}
```

在 xml 中使用时与之前一样，但在 java 代码中却相对麻烦：

```java
user.firstName.set("Google");
int age = user.age.get();
```

## Observable Collections

还有集合类型的类可以用来保存数据：

* ObservableArrayList
* ObservableArrayMap

一个使用 ObservableArrayMap 的例子：

```java
ObservableArrayMap<String, Object> user = new ObservableArrayMap<>();
user.put("firstName", "Google");
user.put("lastName", "Inc.");
user.put("age", 17);
```

在 xml 中可以直接使用 key 访问

```xml
<data>
    <import type="android.databinding.ObservableMap"/>
    <variable name="user" type="ObservableMap&lt;String, Object>"/>
</data>
…
<TextView
   android:text='@{user["lastName"]}'
   android:layout_width="wrap_content"
   android:layout_height="wrap_content"/>
<TextView
   android:text='@{String.valueOf(1 + (Integer)user["age"])}'
   android:layout_width="wrap_content"
   android:layout_height="wrap_content"/>
```