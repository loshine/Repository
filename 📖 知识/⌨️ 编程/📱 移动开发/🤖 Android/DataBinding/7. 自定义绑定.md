# 自定义属性绑定

并不是所有的属性都可以通过 data binding 进行绑定，如：margin 和 padding，以及自定义 View 的属性。

此时我们就需要自定义属性绑定了。

## Setter

属性在绑定的时候，会去寻找对应 View 的对应属性的 Setter，然后传值调用。

利用这种特性，对一些第三方的自定义View，我们就可以继承它，来加上我们的`setter`使用 data binding。

如 Fresco 的 SimpleDraweeView，我们想要直接在 xml 指定`url`，就可以加上：

```java
public void setUrl(String url) {
    view.setImageURI(TextUtils.isEmpty(url) ? null : Uri.parse(url));
}
```

## BindingMethods

如果 View 本身就支持这种属性的 setter，只是 xml 中的属性名字和 java 代码中的方法名不相同呢？难道就为了这个，我们还得去继承 View，使代码产生冗余？

当然没有这么笨，这时候我们可以使用`BindingMethods`注解。

`android:tint`是给 ImageView 加上着色的属性，可以在不换图的前提下改变图标的颜色。如果我们直接对`android:tint`使用 data binding，由于会去查找`setTint`方法，而该方法不存在，会编译出错。

而实际对应的方法，应该是`setImageTintList`，此时我们就可以使用`BindingMethod`指定属性的绑定方法：

```java
@BindingMethods({
       @BindingMethod(type = "android.widget.ImageView",
                      attribute = "android:tint",
                      method = "setImageTintList"),
})
```

## BindingAdapter

如果没有对应的 setter，或者方法签名不同怎么办？`BindingAdapter`注解可以帮我们来做这个。

比如 View 的`android:paddingLeft`属性，是没有对应的直接进行设置的方法的，只有`setPadding(left, top, right, bottom)`，而我们又不可能为了使用 Data Binding 去继承修改这种基础的 View（即便修改了，还有一堆继承它的 View 呢）。又比如那些 margin，需要修改必须拿到 LayoutParams，这些都无法通过简单的 setter 去做。

这时候我们可以使用`BindingAdapter`定义一个静态方法：

```java
@BindingAdapter("android:paddingLeft")
public static void setPaddingLeft(View view, int padding) {
    view.setPadding(padding,
                    view.getPaddingTop(),
                    view.getPaddingRight(),
                    view.getPaddingBottom());
}
```

事实上这个 Adapter 已经由 Data Binding 实现好了，可以在`android.databinding.adapters.ViewBindingAdapter`看到有很多定义好的适配器以及`BindingMethod`。

还可以进行多属性绑定，比如

```java
@BindingAdapter({"bind:imageUrl", "bind:error"})
public static void loadImage(ImageView view, String url, Drawable error) {
    Picasso.with(view.getContext()).load(url).error(error).into(view);
}
```

来使用 Picasso 读取图片到 ImageView。

## BindingConversion

有时候我们想在 xml 中绑定的属性，未必是最后的 setter 需要的，比如我们想用 color(int)，但是 view 需要 Drawable，比如我们想用 String，而 view 需要的是 Url。这

时候我们就可以使用`BindingConversion`：

```xml
<View
    android:background=“@{isError ? @color/red : @color/white}”
    android:layout_width=“wrap_content”
    android:layout_height=“wrap_content”/>
```

```java
    @BindingConversion
    public static ColorDrawable convertColorToDrawable(int color) {
        return new ColorDrawable(color);
    }
```